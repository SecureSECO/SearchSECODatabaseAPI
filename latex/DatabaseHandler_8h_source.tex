\hypertarget{DatabaseHandler_8h_source}{}\doxysection{Database\+Handler.\+h}
\label{DatabaseHandler_8h_source}\index{SearchSECODatabaseAPI/Database-\/API/DatabaseHandler.h@{SearchSECODatabaseAPI/Database-\/API/DatabaseHandler.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{This program has been developed by students from the bachelor Computer Science at}}
\DoxyCodeLine{3 \textcolor{comment}{Utrecht University within the Software Project course.}}
\DoxyCodeLine{4 \textcolor{comment}{Â© Copyright Utrecht University (Department of Information and Computing Sciences)}}
\DoxyCodeLine{5 \textcolor{comment}{*/}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}Types.h"{}}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <tuple>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <cassandra.h>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define IP "{}cassandra"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define DBPORT 8002}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#define HASHES\_INSERT\_MAX 1000}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{using namespace }types;}
\DoxyCodeLine{18 }
\DoxyCodeLine{22 \textcolor{keyword}{class }\mbox{\hyperlink{classDatabaseHandler}{DatabaseHandler}}}
\DoxyCodeLine{23 \{}
\DoxyCodeLine{24 \textcolor{keyword}{public}:}
\DoxyCodeLine{30     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classDatabaseHandler_acb0f7db07929290bb10ee7c424aee9a2}{connect}}(std::string ip, \textcolor{keywordtype}{int} port);}
\DoxyCodeLine{31 }
\DoxyCodeLine{37     \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classDatabaseHandler_a70d4f74d0fe004e6cc054a6aaa49e194}{addProject}}(\mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project);}
\DoxyCodeLine{38 }
\DoxyCodeLine{44     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classDatabaseHandler_a0ba0aeb2e4a38350a5cdd354ca64849c}{addHashToProject}}(\mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{int} index);}
\DoxyCodeLine{45 }
\DoxyCodeLine{55     \textcolor{keyword}{virtual} \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} \mbox{\hyperlink{classDatabaseHandler_a0e968ed675264a5a3a35aef06e9cfca9}{searchForProject}}(ProjectID projectID, Version version);}
\DoxyCodeLine{56 }
\DoxyCodeLine{65     \textcolor{keyword}{virtual} \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} \mbox{\hyperlink{classDatabaseHandler_ad78029a56591f8c817b652f10b96ac07}{prevProject}}(ProjectID projectID);}
\DoxyCodeLine{66 }
\DoxyCodeLine{76     \textcolor{keyword}{virtual} \textcolor{keywordtype}{void} \mbox{\hyperlink{classDatabaseHandler_ab78a94781aaf3e4e692a153675b8c9b2}{addMethod}}(\mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} parserVersion,}
\DoxyCodeLine{77                            \textcolor{keywordtype}{bool} newProject);}
\DoxyCodeLine{78 }
\DoxyCodeLine{87     \textcolor{keyword}{virtual} std::vector<Hash> \mbox{\hyperlink{classDatabaseHandler_a845e3bb5b8470c9e276860e3eac15465}{updateUnchangedFiles}}(std::vector<Hash> hashes, std::vector<std::string> files,}
\DoxyCodeLine{88                                                    \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion);}
\DoxyCodeLine{89 }
\DoxyCodeLine{95     \textcolor{keyword}{virtual} std::vector<MethodOut> \mbox{\hyperlink{classDatabaseHandler_a4e6082f015125e89739d19d1a26f2a39}{hashToMethods}}(std::string hash);}
\DoxyCodeLine{96 }
\DoxyCodeLine{102     \textcolor{keyword}{virtual} \mbox{\hyperlink{structtypes_1_1Author}{Author}} \mbox{\hyperlink{classDatabaseHandler_a0ed09c0a095972ad79dbe40edb27e425}{idToAuthor}}(std::string \textcolor{keywordtype}{id});}
\DoxyCodeLine{103 }
\DoxyCodeLine{109     \textcolor{keyword}{virtual} std::vector<MethodID> \mbox{\hyperlink{classDatabaseHandler_a2cb8107abe12431d2ed230040cf6bca2}{authorToMethods}}(std::string authorID);}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \textcolor{keyword}{private}:}
\DoxyCodeLine{115     \textcolor{keywordtype}{void} addMethodByAuthor(CassUuid authorID, \mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project);}
\DoxyCodeLine{116 }
\DoxyCodeLine{120     \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} getProject(\textcolor{keyword}{const} CassRow *row);}
\DoxyCodeLine{121 }
\DoxyCodeLine{125     \mbox{\hyperlink{structtypes_1_1MethodOut}{MethodOut}} getMethod(\textcolor{keyword}{const} CassRow *row);}
\DoxyCodeLine{126 }
\DoxyCodeLine{130     \mbox{\hyperlink{structtypes_1_1MethodID}{MethodID}} getMethodID(\textcolor{keyword}{const} CassRow *row);}
\DoxyCodeLine{131 }
\DoxyCodeLine{138     \textcolor{keywordtype}{void} addNewMethod(\mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} parserVersion);}
\DoxyCodeLine{139 }
\DoxyCodeLine{147     \textcolor{keywordtype}{void} updateMethod(\mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} startVersion);}
\DoxyCodeLine{148 }
\DoxyCodeLine{158     \textcolor{keywordtype}{void} handleSelectMethodQueryResult(CassFuture *queryFuture, \mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project,}
\DoxyCodeLine{159                                        \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} parserVersion, \textcolor{keywordtype}{bool} \&newProject);}
\DoxyCodeLine{160 }
\DoxyCodeLine{168     std::vector<Hash> handleSelectUnchangedMethodsResult(CassFuture *queryFuture, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project,}
\DoxyCodeLine{169                                                          \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion);}
\DoxyCodeLine{170 }
\DoxyCodeLine{178     CassFuture *executeSelectUnchangedMethodsQuery(std::vector<Hash> hashes, std::vector<std::string> files,}
\DoxyCodeLine{179                                                    \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project);}
\DoxyCodeLine{185     CassUuid createAuthorIfNotExists(\mbox{\hyperlink{structtypes_1_1Author}{Author}} author);}
\DoxyCodeLine{186 }
\DoxyCodeLine{190     \textcolor{keywordtype}{void} setPreparedStatements();}
\DoxyCodeLine{191 }
\DoxyCodeLine{195     CassSession *connection;}
\DoxyCodeLine{196 }
\DoxyCodeLine{200     \textcolor{keyword}{const} CassPrepared *selectMethods;}
\DoxyCodeLine{201     \textcolor{keyword}{const} CassPrepared *selectProject;}
\DoxyCodeLine{202     \textcolor{keyword}{const} CassPrepared *selectPrevProject;}
\DoxyCodeLine{203     \textcolor{keyword}{const} CassPrepared *insertProject;}
\DoxyCodeLine{204     \textcolor{keyword}{const} CassPrepared *addHashesToProject;}
\DoxyCodeLine{205     \textcolor{keyword}{const} CassPrepared *insertMethod;}
\DoxyCodeLine{206     \textcolor{keyword}{const} CassPrepared *insertVulnMethod;}
\DoxyCodeLine{207     \textcolor{keyword}{const} CassPrepared *updateMethods;}
\DoxyCodeLine{208     \textcolor{keyword}{const} CassPrepared *updateUnchangedMethods;}
\DoxyCodeLine{209     \textcolor{keyword}{const} CassPrepared *selectMethod;}
\DoxyCodeLine{210     \textcolor{keyword}{const} CassPrepared *selectUnchangedMethods;}
\DoxyCodeLine{211     \textcolor{keyword}{const} CassPrepared *insertMethodByAuthor;}
\DoxyCodeLine{212     \textcolor{keyword}{const} CassPrepared *selectMethodByAuthor;}
\DoxyCodeLine{213     \textcolor{keyword}{const} CassPrepared *insertAuthorByID;}
\DoxyCodeLine{214     \textcolor{keyword}{const} CassPrepared *selectAuthorByID;}
\DoxyCodeLine{215 \};}

\end{DoxyCode}
