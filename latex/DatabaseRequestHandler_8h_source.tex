\hypertarget{DatabaseRequestHandler_8h_source}{}\doxysection{Database\+Request\+Handler.\+h}
\label{DatabaseRequestHandler_8h_source}\index{SearchSECODatabaseAPI/Database-\/API/DatabaseRequestHandler.h@{SearchSECODatabaseAPI/Database-\/API/DatabaseRequestHandler.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{This program has been developed by students from the bachelor Computer Science at}}
\DoxyCodeLine{3 \textcolor{comment}{Utrecht University within the Software Project course.}}
\DoxyCodeLine{4 \textcolor{comment}{Â© Copyright Utrecht University (Department of Information and Computing Sciences)}}
\DoxyCodeLine{5 \textcolor{comment}{*/}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}Definitions.h"{}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}DatabaseHandler.h"{}}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}Statistics.h"{}}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <tuple>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <queue>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define PROJECT\_DATA\_SIZE 9}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#define METHOD\_DATA\_MIN\_SIZE 5}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define HEX\_CHARS "{}0123456789abcdef"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define UUID\_REGEX "{}[0-\/9a-\/fA-\/F]\{8\}\(\backslash\)\(\backslash\)-\/[0-\/9a-\/fA-\/F]\{4\}\(\backslash\)\(\backslash\)-\/[0-\/9a-\/fA-\/F]\{4\}\(\backslash\)\(\backslash\)-\/[0-\/9a-\/fA-\/F]\{4\}\(\backslash\)\(\backslash\)-\/[0-\/9a-\/fA-\/F]\{12\}"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#define HASHES\_MAX\_SIZE 1000}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#define FILES\_MAX\_SIZE 500}}
\DoxyCodeLine{24 }
\DoxyCodeLine{28 \textcolor{keyword}{class }\mbox{\hyperlink{classDatabaseRequestHandler}{DatabaseRequestHandler}}}
\DoxyCodeLine{29 \{}
\DoxyCodeLine{30 \textcolor{keyword}{public}:}
\DoxyCodeLine{31     \mbox{\hyperlink{classDatabaseRequestHandler}{DatabaseRequestHandler}}(\mbox{\hyperlink{classDatabaseHandler}{DatabaseHandler}} *database, \mbox{\hyperlink{classStatistics}{Statistics}} *stats, std::string ip = IP, \textcolor{keywordtype}{int} port = DBPORT);}
\DoxyCodeLine{32 }
\DoxyCodeLine{47     std::string \mbox{\hyperlink{classDatabaseRequestHandler_aa26a683bd47eafa1425f2d1f10c737eb}{handleUploadRequest}}(std::string request, std::string client);}
\DoxyCodeLine{48 }
\DoxyCodeLine{62     std::string \mbox{\hyperlink{classDatabaseRequestHandler_af15062b404564d90a0641c4eaefc0bca}{handleCheckRequest}}(std::string request);}
\DoxyCodeLine{63 }
\DoxyCodeLine{74     std::string \mbox{\hyperlink{classDatabaseRequestHandler_af15062b404564d90a0641c4eaefc0bca}{handleCheckRequest}}(std::vector<Hash> hashes);}
\DoxyCodeLine{75 }
\DoxyCodeLine{93     std::string \mbox{\hyperlink{classDatabaseRequestHandler_a34cf09ae52f7fd8b465f5581ab718b8e}{handleCheckUploadRequest}}(std::string request, std::string client);}
\DoxyCodeLine{94 }
\DoxyCodeLine{107     std::string \mbox{\hyperlink{classDatabaseRequestHandler_a1cd81237ddaeaa606aca665b0b197f13}{handleExtractProjectsRequest}}(std::string request);}
\DoxyCodeLine{108 }
\DoxyCodeLine{122     std::string \mbox{\hyperlink{classDatabaseRequestHandler_a9efbe2c701268901bde585f39069c01e}{handlePrevProjectsRequest}}(std::string request);}
\DoxyCodeLine{123 }
\DoxyCodeLine{136     std::string \mbox{\hyperlink{classDatabaseRequestHandler_a3b376a30cbbe51e75bf3b5e47dec3932}{handleGetAuthorRequest}}(std::string request);}
\DoxyCodeLine{137 }
\DoxyCodeLine{150     std::string \mbox{\hyperlink{classDatabaseRequestHandler_add5c56b43b4405bb44aacf1209adb9b5}{handleGetMethodsByAuthorRequest}}(std::string request);}
\DoxyCodeLine{151 }
\DoxyCodeLine{157     std::string \mbox{\hyperlink{classDatabaseRequestHandler_ad14b399dc6b837f1ebc7bba4851ab4df}{getExtension}}(std::string file);}
\DoxyCodeLine{158 }
\DoxyCodeLine{159 \textcolor{keyword}{private}:}
\DoxyCodeLine{168     \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} requestToProject(std::string request);}
\DoxyCodeLine{169 }
\DoxyCodeLine{179     \mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} dataEntryToMethod(std::string dataEntry);}
\DoxyCodeLine{180 }
\DoxyCodeLine{191     std::vector<Hash> requestToHashes(std::string request);}
\DoxyCodeLine{192 }
\DoxyCodeLine{198     \textcolor{keywordtype}{bool} isValidHash(Hash hash);}
\DoxyCodeLine{199 }
\DoxyCodeLine{209     std::string methodsToString(std::vector<MethodOut> methods, \textcolor{keywordtype}{char} dataDelimiter, \textcolor{keywordtype}{char} methodDelimiter);}
\DoxyCodeLine{210 }
\DoxyCodeLine{220     std::string projectsToString(std::vector<ProjectOut> projects, \textcolor{keywordtype}{char} dataDelimiter, \textcolor{keywordtype}{char} projectDelimiter);}
\DoxyCodeLine{221 }
\DoxyCodeLine{227     std::vector<MethodOut> getMethods(std::vector<Hash> hashes);}
\DoxyCodeLine{228 }
\DoxyCodeLine{236     std::vector<ProjectOut> getProjects(std::queue<std::pair<ProjectID, Version>> keys);}
\DoxyCodeLine{237 }
\DoxyCodeLine{243     std::vector<ProjectOut> getPrevProjects(std::queue<ProjectID> projectQueue);}
\DoxyCodeLine{244 }
\DoxyCodeLine{251     std::vector<MethodOut> singleHashToMethodsThread(std::queue<Hash> \&hashes, std::mutex \&queueLock);}
\DoxyCodeLine{252 }
\DoxyCodeLine{259     std::vector<ProjectOut> singleSearchProjectThread(std::queue<std::pair<ProjectID, Version>> \&projectKeyQueue,}
\DoxyCodeLine{260                                                       std::mutex \&queueLock);}
\DoxyCodeLine{261 }
\DoxyCodeLine{269     std::vector<ProjectOut> singlePrevProjectThread(std::queue<ProjectID> \&projectIDs, std::mutex \&queueLock);}
\DoxyCodeLine{270 }
\DoxyCodeLine{281     \textcolor{keywordtype}{void} handleUploadThreads(\mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, std::queue<MethodIn> methodQueue, \textcolor{keywordtype}{bool} newProject,}
\DoxyCodeLine{282                              \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} prevProject, std::vector<File> unchangedFiles);}
\DoxyCodeLine{283 }
\DoxyCodeLine{293     \textcolor{keywordtype}{void} singleUploadThread(std::queue<MethodIn> \&methods, std::mutex \&queueLock, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project,}
\DoxyCodeLine{294                             \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} parserVersion, \textcolor{keywordtype}{bool} newProject);}
\DoxyCodeLine{295 }
\DoxyCodeLine{304     \textcolor{keywordtype}{void} handleUpdateUnchangedFilesThreads(\mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} prevProject, }
\DoxyCodeLine{305                                            std::vector<File> unchangedFiles);}
\DoxyCodeLine{306 }
\DoxyCodeLine{317     std::vector<Hash>}
\DoxyCodeLine{318     singleUpdateUnchangedFilesThread(std::queue<std::pair<std::vector<Hash>, std::vector<File>>> \&hashFiles,}
\DoxyCodeLine{319                                      std::mutex \&queueLock, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion);}
\DoxyCodeLine{320 }
\DoxyCodeLine{329     std::string authorsToString(std::vector<std::pair<Author, AuthorID>> authors);}
\DoxyCodeLine{330 }
\DoxyCodeLine{336     std::vector<std::pair<Author, AuthorID>> getAuthors(std::vector<AuthorID> authorIDs);}
\DoxyCodeLine{337 }
\DoxyCodeLine{344     std::vector<std::pair<Author, AuthorID>> singleIDToAuthorThread(std::queue<AuthorID> \&authorIDs,}
\DoxyCodeLine{345                                                                     std::mutex \&queueLock);}
\DoxyCodeLine{346 }
\DoxyCodeLine{352     std::vector<std::pair<MethodID, AuthorID>> getMethodsByAuthor(std::vector<AuthorID> authorIDs);}
\DoxyCodeLine{353 }
\DoxyCodeLine{360     std::vector<std::pair<MethodID, AuthorID>> singleAuthorToMethodsThread(std::queue<AuthorID> \&authorIDs,}
\DoxyCodeLine{361                                                                            std::mutex \&queueLock);}
\DoxyCodeLine{362 }
\DoxyCodeLine{371     std::string methodIDsToString(std::vector<std::pair<MethodID, AuthorID>> methods);}
\DoxyCodeLine{372 }
\DoxyCodeLine{381     std::tuple<> connectWithRetry(std::string ip, \textcolor{keywordtype}{int} port);}
\DoxyCodeLine{382 }
\DoxyCodeLine{388     \textcolor{keywordtype}{bool} tryUploadProjectWithRetry(\mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project);}
\DoxyCodeLine{389 }
\DoxyCodeLine{401     std::tuple<> addMethodWithRetry(\mbox{\hyperlink{structtypes_1_1MethodIn}{MethodIn}} method, \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} parserVersion,}
\DoxyCodeLine{402                                     \textcolor{keywordtype}{bool} newProject);}
\DoxyCodeLine{403 }
\DoxyCodeLine{412     \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} getPrevProjectWithRetry(ProjectID projectID);}
\DoxyCodeLine{413 }
\DoxyCodeLine{425     std::vector<Hash> updateUnchangedFilesWithRetry(std::pair<std::vector<Hash>, std::vector<File>> hashFile,}
\DoxyCodeLine{426                                                     \mbox{\hyperlink{structtypes_1_1ProjectIn}{ProjectIn}} project, \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} prevVersion);}
\DoxyCodeLine{427 }
\DoxyCodeLine{435     std::vector<MethodOut> hashToMethodsWithRetry(Hash hash);}
\DoxyCodeLine{436 }
\DoxyCodeLine{445     \mbox{\hyperlink{structtypes_1_1ProjectOut}{ProjectOut}} searchForProjectWithRetry(ProjectID projectID, Version version);}
\DoxyCodeLine{446 }
\DoxyCodeLine{452     \mbox{\hyperlink{structtypes_1_1Author}{Author}} idToAuthorWithRetry(AuthorID \textcolor{keywordtype}{id});}
\DoxyCodeLine{453 }
\DoxyCodeLine{459     std::vector<MethodID> authorToMethodsWithRetry(AuthorID authorID);}
\DoxyCodeLine{460 }
\DoxyCodeLine{470     \textcolor{keyword}{template} <\textcolor{keyword}{class} T> std::vector<std::vector<T>> toChunks(std::vector<T> list, \textcolor{keywordtype}{int} chunkSize)}
\DoxyCodeLine{471     \{}
\DoxyCodeLine{472         std::vector<T> currentChunk = \{\};}
\DoxyCodeLine{473         std::vector<std::vector<T>> chunks = \{\};}
\DoxyCodeLine{474         \textcolor{keywordflow}{for} (T element : list)}
\DoxyCodeLine{475         \{}
\DoxyCodeLine{476             currentChunk.push\_back(element);}
\DoxyCodeLine{477             \textcolor{keywordflow}{if} (currentChunk.size() >= chunkSize)}
\DoxyCodeLine{478             \{}
\DoxyCodeLine{479                 chunks.push\_back(currentChunk);}
\DoxyCodeLine{480                 currentChunk.clear();}
\DoxyCodeLine{481             \}}
\DoxyCodeLine{482         \}}
\DoxyCodeLine{483         \textcolor{keywordflow}{if} (currentChunk.size() > 0)}
\DoxyCodeLine{484         \{}
\DoxyCodeLine{485             chunks.push\_back(currentChunk);}
\DoxyCodeLine{486         \}}
\DoxyCodeLine{487 }
\DoxyCodeLine{488         \textcolor{keywordflow}{return} chunks;}
\DoxyCodeLine{489     \};}
\DoxyCodeLine{490 }
\DoxyCodeLine{501     \textcolor{keyword}{template} <\textcolor{keyword}{class} T1, \textcolor{keyword}{class} T2>}
\DoxyCodeLine{502     std::queue<std::pair<std::vector<T1>, std::vector<T2>>> cartesianProductQueue(std::vector<std::vector<T1>> listT1,}
\DoxyCodeLine{503                                                                                   std::vector<std::vector<T2>> listT2)}
\DoxyCodeLine{504     \{}
\DoxyCodeLine{505         std::queue<std::pair<std::vector<T1>, std::vector<T2>>> pairQueue;}
\DoxyCodeLine{506         \textcolor{keywordflow}{for} (std::vector<T1> elemT1 : listT1)}
\DoxyCodeLine{507         \{}
\DoxyCodeLine{508             \textcolor{keywordflow}{for} (std::vector<T2> elemT2 : listT2)}
\DoxyCodeLine{509             \{}
\DoxyCodeLine{510                 pairQueue.push(std::make\_pair(elemT1, elemT2));}
\DoxyCodeLine{511             \}}
\DoxyCodeLine{512         \}}
\DoxyCodeLine{513 }
\DoxyCodeLine{514         \textcolor{keywordflow}{return} pairQueue;}
\DoxyCodeLine{515     \};}
\DoxyCodeLine{516 }
\DoxyCodeLine{517     \mbox{\hyperlink{classDatabaseHandler}{DatabaseHandler}} *database;}
\DoxyCodeLine{518     \mbox{\hyperlink{classStatistics}{Statistics}} *stats;}
\DoxyCodeLine{519 \};}

\end{DoxyCode}
