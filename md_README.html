<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SearchSECODatabaseAPI: Database API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SearchSECODatabaseAPI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Database API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><img src="https://github.com/SecureSECO/SearchSECODatabaseAPI/actions/workflows/testing.yml/badge.svg" alt="Testing" style="pointer-events: none;" class="inline"/></p>
<p >The database API is responsible for handling the communication between the controller and the database. A reference documentation can be found <a href="https://secureseco.github.io/SearchSECODatabaseAPI/">here</a>.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Installation</h1>
<p >To install the program you should clone the git repository.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Dependencies</h2>
<p >The database api code has the following dependencies:</p><ul>
<li>Cassandra</li>
<li>Datastax cpp-driver</li>
<li>Boost-asio</li>
</ul>
<p >For running the program using Docker you need the following dependencies installed:</p><ul>
<li><a href="https://docs.docker.com/get-docker/">Docker</a></li>
<li><a href="https://docs.docker.com/compose/install/">Docker compose</a></li>
</ul>
<p >If you want to build the program locally in Linux you will need to perform the following commands to get the required dependencies:</p><ul>
<li><code>sudo apt-get install libboost-all-dev</code></li>
<li><code>wget <a href="http://archive.ubuntu.com/ubuntu/pool/main/g/glibc/multiarch-support_2.27-3ubuntu1.4_amd64.deb">http://archive.ubuntu.com/ubuntu/pool/main/g/glibc/multiarch-support_2.27-3ubuntu1.4_amd64.deb</a></code></li>
<li><code>sudo dpkg -i multiarch-support_2.27-3ubuntu1.4_amd64.deb</code></li>
<li><code>apt-get install libssl-dev libkrb5-dev zlib1g</code></li>
<li><code>wget <a href="https://downloads.datastax.com/cpp-driver/ubuntu/18.04/dependencies/libuv/v1.35.0/libuv1_1.35.0-1_amd64.deb">https://downloads.datastax.com/cpp-driver/ubuntu/18.04/dependencies/libuv/v1.35.0/libuv1_1.35.0-1_amd64.deb</a></code></li>
<li><code>dpkg -i libuv1_1.35.0-1_amd64.deb</code></li>
<li><code>wget <a href="https://downloads.datastax.com/cpp-driver/ubuntu/18.04/cassandra/v2.15.3/cassandra-cpp-driver_2.15.3-1_amd64.deb">https://downloads.datastax.com/cpp-driver/ubuntu/18.04/cassandra/v2.15.3/cassandra-cpp-driver_2.15.3-1_amd64.deb</a></code></li>
<li><code>dpkg -i cassandra-cpp-driver_2.15.3-1_amd64.deb</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Building</h2>
<p >There are two different ways of building the program. You can simply run it using Docker, this is the easiest if you just want to run the program. The other way is to locally build the program using <code>cmake</code> on Linux.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Docker</h3>
<p >In order to start the program using Docker you should first set the variables in the <code>.env</code> file. The <em>LOC</em> is for the location of the data to store, <em>SEEDS</em> is for the IP-addresses of the nodes to connect to and the <em>IP</em> is for the public IP-address of the current computer. In order to contact the rest of the database you should also open ports <code>8001</code> and <code>8002</code>. You can then start the program using <code>docker-compose up -d</code> in the main folder of the repository. This will automatically have your computer join the distributed database. After this the API should be listening on port <code>8003</code> for requests.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Linux</h3>
<p >In order to build the program using <code>cmake</code> you should preform the following commands:</p><ul>
<li><code>mkdir build</code></li>
<li><code>cd build</code></li>
<li><code>cmake ..</code></li>
<li><code>cmake --build .</code></li>
</ul>
<p >The Database API can then be started using <code>./Database-API/Database-API</code>.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Usage</h1>
<p >The database API can handle multiple different requests. Every request has a different four-letter identifier which should be specified in the input. After the identifier the length of the input data should be specified, this is the number of ASCII characters (so <code>\n</code> has a length of 1). Following this should be the input data in the specific format required by the request. The database API supports the following requests for uploading to and extracting from the database:</p><ul>
<li>The <code>check</code> request can be used to check if a method or multiple methods are present in the database.</li>
<li>The <code>upload</code> request can be used to upload or update a project with its specified methods.</li>
<li>The <code>check upload</code> request can be used to match the input data to existing entries in the database, matches will show up on the command-line. After this, the project and methods will be added to the database.</li>
<li>The <code>extract projects</code> request can be used to retrieve the information of projects given their <code>projectID</code>.</li>
<li>The <code>get author</code> request can be used to get the name and email corresponding to an author ID.</li>
<li>The <code>get method by author</code> request can be used to get the methods that an author has worked on.</li>
<li>The <code>get previous project</code> request can be used to get the most recent project of a repository in the database.</li>
</ul>
<p >The API also supports the following requests for the job distribution system:</p><ul>
<li>The <code>connect</code> request can be used to connect a new node to the network.</li>
<li>The <code>upload job</code> request can be used to upload multiple jobs to the jobsqueue.</li>
<li>The <code>upload crawl data</code> request can be used to both upload new jobs and update the crawl id.</li>
<li>The <code>get top job</code> request can be used to get a job.</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
Stopping</h3>
<p >To stop the program you should first tell it to leave the distributed database by using <code>docker exec cassandra nodetool decommision</code>. After this you can use <code>docker stop api</code> and <code>docker stop cassandra</code> to stop the containers.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Running tests</h3>
<p >To locally run the tests(including integration tests) you can first use <code>docker build -f TestingDockerfile -t testing .</code> in the main folder to build the container. After this you can use <code>docker run --name testContainer testing</code> to actually run the tests. This will also generate the code coverage. To copy the code coverage files to a local folder you can use <code>docker cp testContainer:/build/coverage ./coverage</code>. After this you can open <em>index.html</em> in the coverage folder to see the code coverage.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Dashboard</h2>
<p >To run the dashboard on a server you should first create a file called <code>prometheus.yml</code> based on the <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">example</a>. This should contain the ip addresses of the servers with port <code>8000</code>. After this you can use the following commands to start the dashboard: </p><div class="fragment"><div class="line">docker run -p 9090:9090 -p 80:3000 -v /path/to/file:/etc/prometheus -d --name=prometheus prom/prometheus</div>
<div class="line">docker run -d --network=container:prometheus --name=grafana grafana/grafana</div>
</div><!-- fragment --><p> You can then use the ip address of the server you host the dashboard on to access the dashboard.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
License</h1>
<p >This project is licensed under the GNU Affero General Public License v3.0. See [LICENSE](LICENSE) for more info.</p>
<p >This program has been developed by students from the bachelor Computer Science at Utrecht University within the Software Project course. © Copyright Utrecht University (Department of Information and Computing Sciences)</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Licenses for code from other projects</h2>
<ul>
<li><a href="https://cassandra.apache.org/">Cassandra</a>. The license for Cassandra, Cassandra exporter agent and <a href="https://github.com/datastax/cpp-driver">Datastax cpp driver</a> can be found in <a href="external/LICENSE.txt">external/LICENSE</a>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
